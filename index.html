<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸Šç°¡æ˜“æ’²å…‹</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #2d5a27; color: white; }
        .card-display { font-size: 50px; background: white; color: black; width: 100px; height: 140px; 
                        margin: 20px auto; border-radius: 10px; line-height: 140px; }
        .red { color: red; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 5px; border: none; }
        #log { font-size: 12px; color: #ccc; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>â™ ï¸ å¾·å·æ’²å…‹é€£ç·šæ¡Œ â™£ï¸</h1>
    
    <div id="community-cards" style="margin-bottom: 20px;">
        <h3>æ¡Œé¢å…¬ç‰Œ</h3>
        <div id="board" style="display: flex; justify-content: center; gap: 10px; min-height: 80px;">
            </div>
    </div>

    <div id="my-hand">
        <h3>ä½ çš„æ‰‹ç‰Œ</h3>
        <div id="card" class="card-display">?</div>
    </div>

    <div class="controls">
        <button onclick="draw()">æŠ½æ‰‹ç‰Œ</button>
        <hr>
        <p>ç®¡ç†å“¡æ§åˆ¶ï¼š</p>
        <button onclick="start()">æ–°å±€é–‹å§‹</button>
        <button onclick="next()">ç™¼å…¬ç‰Œ</button>
    </div>

    <div id="log"></div>

<div id="player-list" style="background: rgba(0,0,0,0.3); padding: 10px; margin: 10px auto; max-width: 500px; border-radius: 10px;">
    <h4>åœ¨ç·šç©å®¶</h4>
    <div id="players-container" style="display: flex; justify-content: space-around; flex-wrap: wrap;"></div>
</div>

<div id="game-status" style="font-size: 24px; color: #ffeb3b; margin: 10px;">
    ğŸ’° ç¸½åº•æ± : <span id="pot-amount">0</span>
</div>

<div class="player-actions" style="margin: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
    <button onclick="takeAction('check')" style="background: #4CAF50;">éç‰Œ (Check)</button>
    <button onclick="takeAction('call')" style="background: #2196F3;">è·Ÿæ³¨ (Call)</button>
    <button onclick="takeAction('fold')" style="background: #f44336;">è“‹ç‰Œ (Fold)</button>
    
    <div style="margin-top: 10px;">
        <input type="number" id="raise-amount" placeholder="é‡‘é¡" style="width: 80px; padding: 10px;">
        <button onclick="raiseBet()" style="background: #FF5722;">åŠ æ³¨ (Raise)</button>
    </div>
</div>

<div id="setup" style="margin: 10px;">
    <input type="text" id="name-input" placeholder="è¼¸å…¥ä½ çš„æš±ç¨±" style="padding: 10px;">
    <button onclick="changeName()" style="padding: 10px; background: #FF9800;">æ›´å</button>
</div>

<div style="margin-top: 30px; font-size: 14px; background: rgba(0,0,0,0.2); padding: 10px;">
    <strong>ç‰Œå‹ç­‰ç´šåƒè€ƒï¼š</strong><br>
    åŒèŠ±å¤§é † > åŒèŠ±é † > å››æ¢ > è‘«è˜† > åŒèŠ± > é †å­ > ä¸‰æ¢ > å…©å° > å°å­ > é«˜ç‰Œ
</div>

<div id="bet-info" style="font-size: 18px; color: #00e676;">
    ğŸ“¢ æœ¬è¼ªæœ€é«˜æ³¨é¡: <span id="max-bet">0</span>
</div>

<button onclick="autoShowdown()" style="background: #9c27b0;">ğŸ¤– è‡ªå‹•åˆ¤æ–·å‹è² </button>

    <script src="/socket.io/socket.io.js"></script>

    <script>
    function autoShowdown() {
        if (confirm("ç¢ºå®šè¦è®“é›»è…¦åˆ¤æ–·æœ€å¼·ç‰Œå‹å—ï¼Ÿ")) {
            socket.emit('showdown');
        }
    }

    function changeName() {
        const name = document.getElementById('name-input').value;
        socket.emit('setName', name);
    }
    
    // ç›£è½ä¼ºæœå™¨çš„è´å®¶è§¸ç™¼
    socket.on('triggerWinner', (winnerId) => {
        socket.emit('declareWinner', winnerId);
    });
    </script>

    <script>
        function raiseBet() {
            const amt = document.getElementById('raise-amount').value;
            if (!amt) return alert("è«‹è¼¸å…¥åŠ æ³¨é‡‘é¡");
            socket.emit('playerAction', { action: 'raise', amount: amt });
        }
    </script>

    <script>
        const socket = io();
        
        function draw() {
            socket.emit('drawCard');
        }
        function start() { socket.emit('startGame'); }
        function next() { socket.emit('nextPhase'); }
        function takeAction(actionType) {
        socket.emit('playerAction', { action: actionType });
    }


        socket.on('yourHand', (hand) => {
    const handDiv = document.getElementById('my-hand');
    // æ‰¾åˆ°æˆ–å»ºç«‹ä¸€å€‹å®¹å™¨ä¾†æ”¾é€™å…©å¼µç‰Œ
    let cardsArea = document.getElementById('cards-area');
    if (!cardsArea) {
        cardsArea = document.createElement('div');
        cardsArea.id = 'cards-area';
        cardsArea.style.display = 'flex';
        cardsArea.style.justifyContent = 'center';
        cardsArea.style.gap = '10px';
        handDiv.appendChild(cardsArea);
    }
    
    cardsArea.innerHTML = ''; // æ¸…ç©ºèˆŠæ‰‹ç‰Œ
    hand.forEach(card => {
        const c = document.createElement('div');
        c.className = 'card-display ' + (card.suit === 'â™¥' || card.suit === 'â™¦' ? 'red' : '');
        c.style.margin = "0"; // è¦†è“‹åŸæœ¬çš„ auto
        c.innerText = card.value + card.suit;
        cardsArea.appendChild(c);
    });
    document.getElementById('card').style.display = 'none'; // éš±è—åŸæœ¬çš„å•è™Ÿæ¡†
});

    socket.on('gameLog', (msg) => {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += `<p>${msg}</p>`;
        logDiv.scrollTop = logDiv.scrollHeight; // è‡ªå‹•æ²åˆ°åº•éƒ¨
    });

    // æ›´æ–°ç©å®¶æ¸…å–®ä¸¦æ¨™ç¤ºã€Œç•¶å‰ç©å®¶ã€
        socket.on('updatePlayerList', (data) => {
            const container = document.getElementById('players-container');
            container.innerHTML = '';
            for (let id in data.players) {
                const p = data.players[id];
                const pDiv = document.createElement('div');
                
                // é—œéµï¼šæ ¹æ“šæ˜¯å¦ç‚ºç•¶å‰ç©å®¶ï¼ŒåŠ å…¥å°æ‡‰çš„ class
                pDiv.className = `player-card ${id === data.currentTurn ? 'active-turn' : ''}`;
                
                const isMe = id === socket.id ? " (ä½ )" : "";
                // å¢åŠ é¡¯ç¤ºæ‰‹ç‰Œç‹€æ…‹ (è“‹ç‰Œæˆ–æœ‰ç‰Œ)
                const status = p.hand.length === 0 && gameState.phase !== 'deal' ? " (å·²è“‹ç‰Œ)" : "";
                
                pDiv.innerHTML = `
                    <div style="font-weight: bold;">ğŸ‘¤ ${p.name}${isMe}</div>
                    <div style="color: #ffeb3b;">ğŸ’° ${p.chips}</div>
                    <div style="font-size: 14px; color: #00e676;">ğŸª™ æŠ•å…¥: ${p.roundBet}</div>
                    <div style="font-size: 10px; color: #aaa;">${status}</div>
                `;
                container.appendChild(pDiv);
            }

            const isMyTurn = (data.currentTurn === socket.id);
            document.querySelectorAll('.player-actions button').forEach(btn => {
                btn.disabled = !isMyTurn;
                btn.style.opacity = isMyTurn ? "1" : "0.5";
            });
        });

        socket.on('updateStatus', (data) => {
            document.getElementById('pot-amount').innerText = data.pot;
            // å¦‚æœä¼ºæœå™¨æœ‰å›å‚³ currentMaxBet ä¹Ÿè¦æ›´æ–°
            if(data.currentMaxBet !== undefined) {
                document.getElementById('max-bet').innerText = data.currentMaxBet;
            }
        });

        // åœ¨ startGame æ™‚æ¸…ç©ºæ‰‹ç‰Œç•«é¢
        socket.on('updateBoard', (cards) => {
            const boardDiv = document.getElementById('board');
            const cardQuestDiv = document.getElementById('card'); // åŸæœ¬çš„ "?" æ¡†
            const cardsArea = document.getElementById('cards-area'); // ç©å®¶æ‰‹ç‰Œå€åŸŸ

            // 1. å…ˆæ¸…ç©ºæ¡Œé¢å…¬ç‰Œå€
            boardDiv.innerHTML = ''; 

            // 2. å¦‚æœå‚³å…¥çš„æ˜¯ç©ºé™£åˆ— (ä»£è¡¨æ–°å±€é‡ç½®)
            if (!cards || cards.length === 0) {
                if (cardsArea) cardsArea.innerHTML = ''; // æ¸…ç©ºæ‰‹ç‰Œç•«é¢
                cardQuestDiv.style.display = 'block';    // é¡¯ç¤ºå•è™Ÿæ¡†
                cardQuestDiv.innerText = '?';
                return;
            }

            // 3. å¦‚æœæœ‰å…¬ç‰Œï¼Œéš±è—å•è™Ÿæ¡†ä¸¦æ¸²æŸ“ç‰Œçµ„
            cardQuestDiv.style.display = 'none'; 
            cards.forEach(card => {
                const c = document.createElement('div');
                // åˆ¤æ–·èŠ±è‰²æ˜¯å¦ç‚ºç´…è‰²
                const isRed = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : '';
                c.className = `card-display small ${isRed}`;
                c.innerText = card.value + card.suit;
                boardDiv.appendChild(c);
            });
        });
    </script>

    <style>
        /* æ–°å¢ä¸€äº›æ¨£å¼è®“å…¬ç‰Œè®Šå°ä¸€é» */
        .card-display.small {
            width: 60px; height: 80px; font-size: 24px; line-height: 80px; margin: 0;
        }

        #players-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            padding: 15px;
        }
        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .active-turn {
            border-color: #ffeb3b !important;
            background: rgba(255, 235, 59, 0.15) !important;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.5);
        }

        /* é‡å°æ‰‹æ©Ÿè§¸æ§å„ªåŒ– */
        button {
            min-height: 50px; /* å¢åŠ é»æ“Šå€åŸŸ */
            margin: 5px;
            touch-action: manipulation;
        }

        .player-actions {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å…©å…©ä¸¦æ’ï¼Œæ–¹ä¾¿å¤§æ‹‡æŒ‡æŒ‰ */
            gap: 10px;
        }

        #my-hand .card-display {
            width: 70px; /* æ‰‹æ©Ÿä¸Šç‰Œç¸®å°ä¸€é» */
            height: 100px;
            line-height: 100px;
            font-size: 30px;
        }
    </style>
</body>
</html>